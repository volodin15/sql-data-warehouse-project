CREATE OR REPLACE PROCEDURE bronze.load_bronze()
LANGUAGE plpgsql
AS $$
BEGIN   
	/*
	temp link for file in local MinIO
	need to update pg container and install curl to make it work
	*/
	
	TRUNCATE TABLE bronze.crm_cust_info;
	
	COPY bronze.crm_cust_info 
	FROM PROGRAM 'curl "http://192.168.0.101:9001/api/v1/download-shared-object/aHR0cDovLzEyNy4wLjAuMTo5MDAwL3NxbC1kYXRhLXdhcmVob3VzZS1wcm9qZWN0LWRhdGFzZXRzL3NvdXJjZV9jcm0vY3VzdF9pbmZvLmNzdj9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPVBUSTQ3U0pCMTlPS0VRWDNDWkJRJTJGMjAyNTA5MDMlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwOTAzVDExMjEyOFomWC1BbXotRXhwaXJlcz00MzIwMCZYLUFtei1TZWN1cml0eS1Ub2tlbj1leUpoYkdjaU9pSklVelV4TWlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKaFkyTmxjM05MWlhraU9pSlFWRWswTjFOS1FqRTVUMHRGVVZnelExcENVU0lzSW1WNGNDSTZNVGMxTmprME1UTTVPU3dpY0dGeVpXNTBJam9pYldsdWFXOWhaRzFwYmlKOS5MZGlGOXpPOFNqSGlOVy1BM21uWWVGekhUeWFwX1lmVEVCM3JXbVFNWE1rVkhqVnRPT3YxNXg5SHloR2g2dUtLMzJBYnBoVWVMTjhEQ3l1ZzRGbGJqUSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmdmVyc2lvbklkPW51bGwmWC1BbXotU2lnbmF0dXJlPWY5OTIwMzQzYjk0NzcxMzc2NmZhM2NhYjZiYTIyNWJlZDBmNjg3OGE4NTRkMjk3MzEyNzZmYzYyOWNjODMyYjQ"' 
	WITH (FORMAT csv, HEADER);
	
	-- check if data in columns is ok
	--SELECT * FROM bronze.crm_cust_info;
	-- check if all rows are in table
	--SELECT count(*) FROM bronze.crm_cust_info;
	
	---
	
	TRUNCATE TABLE bronze.crm_prd_info;
	
	COPY bronze.crm_prd_info
	FROM PROGRAM 'curl "http://192.168.0.101:9001/api/v1/download-shared-object/aHR0cDovLzEyNy4wLjAuMTo5MDAwL3NxbC1kYXRhLXdhcmVob3VzZS1wcm9qZWN0LWRhdGFzZXRzL3NvdXJjZV9jcm0vcHJkX2luZm8uY3N2P1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9UFRJNDdTSkIxOU9LRVFYM0NaQlElMkYyMDI1MDkwMyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTA5MDNUMTE0MTUyWiZYLUFtei1FeHBpcmVzPTQzMjAwJlgtQW16LVNlY3VyaXR5LVRva2VuPWV5SmhiR2NpT2lKSVV6VXhNaUlzSW5SNWNDSTZJa3BYVkNKOS5leUpoWTJObGMzTkxaWGtpT2lKUVZFazBOMU5LUWpFNVQwdEZVVmd6UTFwQ1VTSXNJbVY0Y0NJNk1UYzFOamswTVRNNU9Td2ljR0Z5Wlc1MElqb2liV2x1YVc5aFpHMXBiaUo5LkxkaUY5ek84U2pIaU5XLUEzbW5ZZUZ6SFR5YXBfWWZURUIzcldtUU1YTWtWSGpWdE9PdjE1eDlIeWhHaDZ1S0szMkFicGhVZUxOOERDeXVnNEZsYmpRJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZ2ZXJzaW9uSWQ9bnVsbCZYLUFtei1TaWduYXR1cmU9YjFlYWZlM2JkZDI2MGIxZjdmYWUyNjFhYWYyNzkwZmVjNzRiNGIzNDJjYWZjM2FlMzNjM2U3MmRlZThhN2M3ZQ"' 
	WITH (FORMAT csv, HEADER);
	
	-- check if data in columns is ok
	--SELECT * FROM bronze.crm_prd_info;
	-- check if all rows are in table
	--SELECT count(*) FROM bronze.crm_prd_info;
	
	---
	TRUNCATE TABLE bronze.crm_sales_details;
	
	COPY bronze.crm_sales_details
	FROM PROGRAM 'curl "http://192.168.0.101:9001/api/v1/download-shared-object/aHR0cDovLzEyNy4wLjAuMTo5MDAwL3NxbC1kYXRhLXdhcmVob3VzZS1wcm9qZWN0LWRhdGFzZXRzL3NvdXJjZV9jcm0vc2FsZXNfZGV0YWlscy5jc3Y_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1QVEk0N1NKQjE5T0tFUVgzQ1pCUSUyRjIwMjUwOTAzJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDkwM1QxMTQ5MjBaJlgtQW16LUV4cGlyZXM9NDMyMDAmWC1BbXotU2VjdXJpdHktVG9rZW49ZXlKaGJHY2lPaUpJVXpVeE1pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SmhZMk5sYzNOTFpYa2lPaUpRVkVrME4xTktRakU1VDB0RlVWZ3pRMXBDVVNJc0ltVjRjQ0k2TVRjMU5qazBNVE01T1N3aWNHRnlaVzUwSWpvaWJXbHVhVzloWkcxcGJpSjkuTGRpRjl6TzhTakhpTlctQTNtblllRnpIVHlhcF9ZZlRFQjNyV21RTVhNa1ZIalZ0T092MTV4OUh5aEdoNnVLSzMyQWJwaFVlTE44REN5dWc0RmxialEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JnZlcnNpb25JZD1udWxsJlgtQW16LVNpZ25hdHVyZT00NGJjZTM4ZGMzMjY0MWE2NzVhNDczNDgzN2I1NzEyMWY4MDI2ZjNhNmEzNWVmYzJiNmEwYTczNWJjYWY1YWM2"' 
	WITH (FORMAT csv, HEADER);
	
	-- check if data in columns is ok
	--SELECT * FROM bronze.crm_sales_details;
	-- check if all rows are in table
	--SELECT count(*) FROM bronze.crm_sales_details;
	
	---
	
	TRUNCATE TABLE bronze.erp_cust_az12;
	
	COPY bronze.erp_cust_az12
	FROM PROGRAM 'curl "http://192.168.0.101:9001/api/v1/download-shared-object/aHR0cDovLzEyNy4wLjAuMTo5MDAwL3NxbC1kYXRhLXdhcmVob3VzZS1wcm9qZWN0LWRhdGFzZXRzL3NvdXJjZV9lcnAvQ1VTVF9BWjEyLmNzdj9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPVBUSTQ3U0pCMTlPS0VRWDNDWkJRJTJGMjAyNTA5MDMlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwOTAzVDExNTUxNFomWC1BbXotRXhwaXJlcz00MzE5OSZYLUFtei1TZWN1cml0eS1Ub2tlbj1leUpoYkdjaU9pSklVelV4TWlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKaFkyTmxjM05MWlhraU9pSlFWRWswTjFOS1FqRTVUMHRGVVZnelExcENVU0lzSW1WNGNDSTZNVGMxTmprME1UTTVPU3dpY0dGeVpXNTBJam9pYldsdWFXOWhaRzFwYmlKOS5MZGlGOXpPOFNqSGlOVy1BM21uWWVGekhUeWFwX1lmVEVCM3JXbVFNWE1rVkhqVnRPT3YxNXg5SHloR2g2dUtLMzJBYnBoVWVMTjhEQ3l1ZzRGbGJqUSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmdmVyc2lvbklkPW51bGwmWC1BbXotU2lnbmF0dXJlPTQ0YTE1ZjZlNTc4MzcyOGQyNDFkZDQ2YWFkZGVhNjBlOTgwYTU3ZTM0NTA3OWYyMDI4ODYzZTUwMDgyYjM5N2M"' 
	WITH (FORMAT csv, HEADER);
	
	-- check if data in columns is ok
	--SELECT * FROM bronze.erp_cust_az12;
	-- check if all rows are in table
	--SELECT count(*) FROM bronze.erp_cust_az12;
	
	---
	TRUNCATE TABLE bronze.erp_loc_a101;
	
	COPY bronze.erp_loc_a101
	FROM PROGRAM 'curl "http://192.168.0.101:9001/api/v1/download-shared-object/aHR0cDovLzEyNy4wLjAuMTo5MDAwL3NxbC1kYXRhLXdhcmVob3VzZS1wcm9qZWN0LWRhdGFzZXRzL3NvdXJjZV9lcnAvTE9DX0ExMDEuY3N2P1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9UFRJNDdTSkIxOU9LRVFYM0NaQlElMkYyMDI1MDkwMyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTA5MDNUMTE1NzEwWiZYLUFtei1FeHBpcmVzPTQzMjAwJlgtQW16LVNlY3VyaXR5LVRva2VuPWV5SmhiR2NpT2lKSVV6VXhNaUlzSW5SNWNDSTZJa3BYVkNKOS5leUpoWTJObGMzTkxaWGtpT2lKUVZFazBOMU5LUWpFNVQwdEZVVmd6UTFwQ1VTSXNJbVY0Y0NJNk1UYzFOamswTVRNNU9Td2ljR0Z5Wlc1MElqb2liV2x1YVc5aFpHMXBiaUo5LkxkaUY5ek84U2pIaU5XLUEzbW5ZZUZ6SFR5YXBfWWZURUIzcldtUU1YTWtWSGpWdE9PdjE1eDlIeWhHaDZ1S0szMkFicGhVZUxOOERDeXVnNEZsYmpRJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZ2ZXJzaW9uSWQ9bnVsbCZYLUFtei1TaWduYXR1cmU9Mjg5YjIxZDgwMWM1MzY3ODI4MGQwM2RlNDM0OWU4YWE1MmU3ZGNhNjZhN2E1NDdjMmZlOTFmYjI1MmJiNmQzNg"'
	WITH (FORMAT csv, HEADER);
	
	-- check if data in columns is ok
	--SELECT * FROM bronze.erp_loc_a101;
	-- check if all rows are in table
	--SELECT count(*) FROM bronze.erp_loc_a101;
	
	---
	TRUNCATE TABLE bronze.erp_px_cat_g1v2;
	
	COPY bronze.erp_px_cat_g1v2
	FROM PROGRAM 'curl "http://192.168.0.101:9001/api/v1/download-shared-object/aHR0cDovLzEyNy4wLjAuMTo5MDAwL3NxbC1kYXRhLXdhcmVob3VzZS1wcm9qZWN0LWRhdGFzZXRzL3NvdXJjZV9lcnAvUFhfQ0FUX0cxVjIuY3N2P1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9UFRJNDdTSkIxOU9LRVFYM0NaQlElMkYyMDI1MDkwMyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTA5MDNUMTE1ODI3WiZYLUFtei1FeHBpcmVzPTQzMTk5JlgtQW16LVNlY3VyaXR5LVRva2VuPWV5SmhiR2NpT2lKSVV6VXhNaUlzSW5SNWNDSTZJa3BYVkNKOS5leUpoWTJObGMzTkxaWGtpT2lKUVZFazBOMU5LUWpFNVQwdEZVVmd6UTFwQ1VTSXNJbVY0Y0NJNk1UYzFOamswTVRNNU9Td2ljR0Z5Wlc1MElqb2liV2x1YVc5aFpHMXBiaUo5LkxkaUY5ek84U2pIaU5XLUEzbW5ZZUZ6SFR5YXBfWWZURUIzcldtUU1YTWtWSGpWdE9PdjE1eDlIeWhHaDZ1S0szMkFicGhVZUxOOERDeXVnNEZsYmpRJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZ2ZXJzaW9uSWQ9bnVsbCZYLUFtei1TaWduYXR1cmU9YjMyZDI4YTFhZGE3MDRjMWQ2NWY1ZDk2MTIwODA2NjFhYTIzN2U1N2ZiMjZhYzRiMjg4MDQxMjBkZmU5OWRkOQ"'
	WITH (FORMAT csv, HEADER);
	
	-- check if data in columns is ok
	--SELECT * FROM bronze.erp_px_cat_g1v2;
	-- check if all rows are in table
	--SELECT count(*) FROM bronze.erp_px_cat_g1v2;

END;
$$;

call bronze.load_bronze();




